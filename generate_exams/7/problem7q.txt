create database problem7;
use problem7;

create table article (
   id int unsigned not null primary key auto_increment,
	 published_on date,
	 name varchar(20)
);

create table category (
   id int unsigned not null primary key auto_increment,
	 description varchar(20),
	 name varchar(20)
);

create table user (
   id int unsigned not null primary key auto_increment,
	 age int,
	 password varchar(20),
	 name varchar(20)
);

create table tag (
   id int unsigned not null primary key auto_increment,
	 priority int,
	 description varchar(20)
);

alter table tag add column category_id int unsigned not null;
alter table user add column article_id int unsigned not null;

create table user_tag (
  id int unsigned not null primary key auto_increment,
  tag_id int unsigned not null,
  user_id int unsigned not null
);

insert into article (id,published_on,name) values
	(1, '2013-02-21', 'rgdrg6'),
  (2, '2011-02-06', 'sefsef');

insert into category (id,description,name) values
	(1, 'sfsefs', 'sfeef'),
  (2, 'fsefesef', 'sefsef');

insert into user (id,age,password,name, article_id) values
	(1, 21, '653', 'sfesef', 1),
  (2, 22, '6834', 'sefsef', 2);

insert into tag (id,priority,description, category_id) values
	(1, 21, 'sfeefse', 2),
  (2, 54, 'feset4yg', 1);

insert into user_tag(id, user_id, tag_id) values
  (1, 2, 1), 
  (2, 1, 2);

select user.* from user_tag join user on user.id = user_tag.user_id join tag on tag.id = user_tag.tag_id where tag.category_id = (select id from category where category.name = 'sfeef');

create table tag_part1 (id int unsigned not null auto_increment, description varchar(20), primary key (id));
create table tag_part2 (id int unsigned not null auto_increment, priority int, category_id int unsigned not null, primary key (id));
insert into tag_part1 (description) select description from tag;
insert into tag_part2 (priority, category_id) select priority, category_id from tag;
drop table tag;

select article.* from user join article on article.id = user.article_id join user_tag on user_tag.user_id=user.id where user_tag.tag_id=(select id from tag_part1 where tag_part1.id = 1);
